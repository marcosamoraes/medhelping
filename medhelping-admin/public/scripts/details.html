<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <link
            href="http://fonts.googleapis.com/css?family=Lato:400,700"
            rel="stylesheet"
            type="text/css"
        />
        <script
            src="https://code.jquery.com/jquery-3.6.1.min.js"
            integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"
            crossorigin="anonymous"
        ></script>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
            integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
            crossorigin="anonymous"
        />
        <script src="https://use.fontawesome.com/244a80fab0.js"></script>
        <script src="./GBJSTK.js"></script>
        <script src="./requests.js"></script>
    </head>
    <body>
        <div
            id="loader"
            class="d-none align-items-center justify-content-center position-fixed top-0 start-0 end-0 bottom-0"
            style="background-color: rgba(0, 0, 0, 0.5)"
        >
            <div class="spinner-border" role="status">
                <span class="sr-only"></span>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div
                        class="row article-info d-flex justify-content-center"
                    ></div>
                    <div
                        class="row comments-list d-flex justify-content-center px-3"
                    ></div>
                </div>
            </div>
        </div>
        <input type="hidden" name="user_email" />
        <input type="hidden" name="article_id" />

        <script>
            let loaded = false;
            function gbPluginDidLoad() {
                gbGetUser();
                loaded = true;
                if (gbPostData && gbPostData["id"]) {
                    var id = decodeURIComponent(gbPostData["id"]);
                    getPostAndComments(id);
                }
            }
            function getPostAndComments(id) {
                $('[name="article_id"]').val(id);

                gbRequest(
                    "https://agenciamoraes.com/sites/medhelping/api/article/show/" +
                        id,
                    3
                );

                gbRequest(
                    "https://agenciamoraes.com/sites/medhelping/api/comment/list/" +
                        id,
                    4
                );
            }
            function getPostAndCommentsShared(id) {
                $('[name="article_id"]').val(id);
                $.get("https://agenciamoraes.com/sites/medhelping/api/article/show/" + id, (article) => showArticle(article));
                $.get("https://agenciamoraes.com/sites/medhelping/api/comment/list/" + id, (data) => listComments(data));

            }
            function likeButton() {
                let $postLiked = Cookies.get(`'postLiked-${gbPostData["id"]}`);
                if ($postLiked) {
                    Cookies.set(`'postLiked-${gbPostData["id"]}`, 0);
                } else {
                    Cookies.set(`'postLiked-${gbPostData["id"]}`, 1);
                }
                let data = {
                    article_id: gbPostData["id"],
                    user_email: $('[name="user_email"]').val(),
                };
                gbRequest(
                    "https://agenciamoraes.com/sites/medhelping/api/article/like",
                    6,
                    "NO",
                    "POST",
                    data
                );
            }
            function likeButtonComment(commentId) {
                let $commentLiked = Cookies.get(`'commentLiked-${commentId}`);
                if ($commentLiked) {
                    Cookies.set(`'commentLiked-${commentId}`, 0);
                } else {
                    Cookies.set(`'commentLiked-${commentId}`, 1);
                }
                let data = {
                    comment_id: commentId,
                    user_email: $('[name="user_email"]').val(),
                };
                gbRequest(
                    "https://agenciamoraes.com/sites/medhelping/api/comment/like",
                    7,
                    "NO",
                    "POST",
                    data
                );
            }
        </script>
    </body>
</html>
